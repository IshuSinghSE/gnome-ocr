#!/usr/bin/make -f

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

export PYBUILD_NAME=gnome-text-extractor
export PYBUILD_DISABLE=test

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_install:
	dh_auto_install
	# Install desktop file
	install -D -m 0644 install/text-extractor.desktop \
		debian/gnome-text-extractor/usr/share/applications/text-extractor.desktop
	# Install icon if exists
	if [ -f install/icon.png ]; then \
		install -D -m 0644 install/icon.png \
			debian/gnome-text-extractor/usr/share/icons/hicolor/256x256/apps/text-extractor.png; \
	fi

override_dh_python3:
	dh_python3
	# Bundle Python dependencies that aren't in Debian repos
	python3 -m pip install --target=debian/gnome-text-extractor/usr/lib/python3/dist-packages \
		rapidocr-onnxruntime>=1.3.0 \
		onnxruntime>=1.16.0 \
		opencv-python-headless>=4.8.0 || true
