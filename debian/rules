#!/usr/bin/make -f

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

export PYBUILD_NAME=gnome-text-extractor
export PYBUILD_DISABLE=test

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_install:
	dh_auto_install
	# Install desktop file
	install -D -m 0644 install/text-extractor.desktop \
		debian/gnome-text-extractor/usr/share/applications/text-extractor.desktop
	# Install icon if exists
	if [ -f install/icon.png ]; then \
		install -D -m 0644 install/icon.png \
			debian/gnome-text-extractor/usr/share/icons/hicolor/256x256/apps/text-extractor.png; \
	fi

override_dh_python3:
	dh_python3
	# Bundle only OCR-specific dependencies that aren't in Debian repos
	# Install to a vendor directory to avoid conflicts
	mkdir -p debian/gnome-text-extractor/usr/lib/gnome-text-extractor/vendor
	python3 -m pip install --target=debian/gnome-text-extractor/usr/lib/gnome-text-extractor/vendor \
		rapidocr-onnxruntime>=1.3.0 \
		onnxruntime>=1.16.0 || true
	# Create a .pth file to add vendor directory to Python path
	mkdir -p debian/gnome-text-extractor/usr/lib/python3/dist-packages
	echo "/usr/lib/gnome-text-extractor/vendor" > debian/gnome-text-extractor/usr/lib/python3/dist-packages/gnome-text-extractor-vendor.pth
